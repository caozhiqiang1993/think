<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover" />
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_746239_sfcfjc4mgbf.css">
    <link rel="stylesheet" href="INDEX_PUBLIC_CSS/main.css">
    <link rel="stylesheet" href="INDEX_PUBLIC_CSS/message.css">
    <link rel="stylesheet" href="INDEX_PUBLIC_CSS/findUser.css">
    <link rel="stylesheet" href="INDEX_PUBLIC_CSS/userInfo.css">
    <link rel="stylesheet" href="INDEX_PUBLIC_CSS/user.css">
    <title>æˆ‘çš„IM</title>
  </head>
  <body>
    <div class="hello">
    <div id="header">
      <p>
        <span>
          {{title}}
        </span>
      </p>
    </div>
    <div style="height: 2.2rem;"></div>

    <div id="content">
      <!-- èŠå¤©è®°å½•åˆ—è¡¨start -->
      <div id="chat_log" v-show="contentIndex == 0">
        <ul>
            <li v-for="item,key in userAllMsg" @click="handleRouter(key)">
              <div class="img_box">
                <span><img :src="friendsList[key].img"></span>
              </div>
              <div class="info_box">
                <span v-text="friendsList[key].user_name"></span>
                <p v-text="item.length > 0 ? item[item.length - 1].msg : ''"></p>
              </div>
            </li>
        </ul>
      </div>
      <!-- èŠå¤©è®°å½•åˆ—è¡¨end -->

      <!-- å¥½å‹åˆ—è¡¨start -->
      <div id="friends" v-show="contentIndex == 1">
        <ul class="friends_h">
          <template v-for="item,index in friendsHeader">
            <li v-if="index == 0" @click="appayList()">
              <div class="fh_img 2">
                <i :class="item.iconName"></i>
              </div>
              <div class="fh_text">
                <span v-text="item.text"></span>
              </div>
            </li>
            <li v-else>
              <div class="fh_img">
                <i :class="item.iconName"></i>
              </div>
              <div class="fh_text">
                <span v-text="item.text"></span>
              </div>
            </li>

          </template>
        </ul>

        <ul class="friends_f">
          <li v-for="item,index in groupingFriendList">
            <h5 @click="item.show = !item.show">
              <i class="iconfont icon-htbarrowright02" :class="{rotate90 : item.show}"></i>
              <span v-text="item.name"></span>
              <em>
                (<span v-text="item.num"></span>)
              </em>
            </h5>
            <ul class="friends_info" v-show="item.show">
              <template v-for="user,key in item.users">
                <li v-show="user.user_id != user_id" @click="checkUserInfo(user,2)">
                  <div class="friends_img_box">
                    <span><img :src="user.img"></span>
                  </div>
                  <div class="friends_info_box">
                    <span v-text="user.user_name"></span>
                    <p v-text="user.explain"></p>
                  </div>
                </li>
              </template>
            </ul>
          </li>
        </ul>
      </div>
      <!-- å¥½å‹åˆ—è¡¨end -->

      <!-- æ›´å¤šstart -->
      <div id="more" v-show="contentIndex == 2">
        <ul>
          <template v-for="item,key in more">
            <li v-if="key == 0" @click="userLeft == 100 ?userLeft=0:userLeft=100">
              <div class="more_img">
                <i :class="item.icon"></i>
              </div>
              <div class="more_text">
                <span v-text="item.name"></span>
              </div>
            </li>
            <li v-else>
              <div class="more_img">
                <i :class="item.icon"></i>
              </div>
              <div class="more_text">
                <span v-text="item.name"></span>
              </div>
            </li>
          </template>
        </ul>
      </div>
      <!-- æ›´å¤šend -->
      <div style="height: 2.2rem;"></div>
    </div>




    <div id="footer">
      <ul>
        <li v-for="(item,index) in footerInfo" @click="contentIndex = index" :class="{active : contentIndex == index}">
          <p><i :class="[item.iconName,{reversal : index == 0}]" class="icon"></i></p>
          <span v-text="item.text"></span>
        </li>
      </ul>
    </div>

    <div>
    </div>

      <!--èŠå¤©start-->
      <div id="message" v-bind:style="{ left: left + '%' }">
        <div id="msg_header" ref="header">
          <div class="header_img">
            <i class="iconfont icon-left" @click="left == 0 ? left =100 : left =0"></i>
          </div>
          <div class="header_text">
            <span v-text="msgTitle.user_name"></span>
          </div>
        </div>
        <div id="msg_content">
          <div class="msg_info" ref="msg_info" @click="isShowEmoji=0">
            <ul>
              <li v-for="(item,index) in userMsg" class="" v-bind:class="{ 'msg_info_li_right': user_id == item.user_id}">
                <div class="msg_user_info" class="" v-bind:class="{ 'msg_user_info_right': user_id == item.user_id}">
                  <img :src="friendsList[item.user_id].img">
                  <span v-text="friendsList[item.user_id].user_name" class="" v-bind:class="{ 'msg_user_info_text_right': user_id == item.user_id}"></span>
                </div>
                <div class="msg_msg" class="" v-bind:class="{ 'msg_msg_right': user_id == item.user_id}">
                  <p v-text="item.msg"></p>
                </div>
              </li>
              <!--<li class="interval_time">
                <span>07-07 14:28</span>
              </li>-->

            </ul>
          </div>
          <div class="input_box">
            <div class="input_text">
              <input type="text" v-model="Message" id="send_message">
              <button v-if="Message != ''" @click="senMessage()" class="botton_color">å‘é€</button>
              <button v-else>å‘é€</button>
            </div>
            <div class="more_function">
              <span class="iconfont icon-smile biaoqing" @click="isShowEmoji=!isShowEmoji"></span>
              <span class="iconfont icon-tupian"></span>
              <span class="iconfont icon-iconset0196"></span>
            </div>
            <div id="biaoqing" v-show="isShowEmoji">
              <table>
                <tr v-for="item,key in emoji">
                  <td v-for="val,index in item" v-text="val" @click.stop="addEmoji(key,index)"></td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </div>
      <!--èŠå¤©end-->

      <!--æŸ¥æ‰¾å¥½å‹start-->
      <div id="findUser" v-bind:style="{ left: findUserLeft + '%' }">
        <div class="findUserHeader">
          <i class="iconfont icon-left" @click="findUserLeft==0?findUserLeft=100:findUserLeft=0"></i>
          <span>æ·»åŠ å¥½å‹</span>
        </div>
        <div class="findUserButton">
          <i></i><input type="text" placeholder="ç”¨æˆ·å" v-model="findUserText"><span @click="findUser()">æœç´¢</span>
        </div>
        <div class="applyTest">
          <span>æ–°çš„å¥½å‹</span>
        </div>
        <div class="applyList">
          <ul>
            <li v-for="item in findApplyList.list" @click="checkUserInfo(item,2)">
              <div class="img_box">
                <span><img :src="item.img"></span>
              </div>
              <div class="info_box">
                <span v-text="item.user_name"></span>
                <p v-text="item.memo"></p>
              </div>
              <div class="info_botton">
                <span v-if="item.status == 0" @click.stop="applyDeal(item,1)" class="botton_color">æ¥å—</span>
                <span v-else-if="item.status == 1">å·²æ¥å—</span>
                <span v-else-if="item.status == 2">å·²æ‹’ç»</span>
              </div>
            </li>
          </ul>
        </div>
      </div>
      <!--æŸ¥æ‰¾å¥½å‹end-->

      <!--å¥½å‹ä¿¡æ¯start-->
      <div id="userInfo" v-bind:style="{ left: userInfoLeft + '%' }">
        <div class="userInfoHeader">
          <i class="iconfont icon-left" @click="userInfoLeft==0?userInfoLeft=100:userInfoLeft=0"></i>
          <span>å¥½å‹èµ„æ–™</span>
        </div>
        <div class="userImgName">
          <div class="floarLeft userInfoImg">
            <img :src="findUserInfo.img">
          </div>
          <div class="floarLeft userInfoName">
            <p v-text="findUserInfo.user_name"></p>
          </div>
        </div>
        <div class="addUser">
          <template v-if="findUserInfo.type == 1">
            <div class="addUserButton" @click="addApply()">
              æ·»åŠ å¥½å‹
            </div>
          </template>
          <template v-else-if="findUserInfo.type == 2">
            <template v-if="findUserInfo.status == 0">
              <div class="addUserButton" @click="applyDeal(findUserInfo,1)">
                é€šè¿‡ç”³è¯·
              </div>
              <div class="addUserButton rejectButton" @click="applyDeal(findUserInfo,2)">
                æ‹’ç»ç”³è¯·
              </div>
            </template>
            <template v-else>
              <div class="addUserButton" @click="handleRouter(findUserInfo.user_id);">
                å‘æ¶ˆæ¯
              </div>
            </template>
          </template>

        </div>
      </div>
      <!--å¥½å‹ä¿¡æ¯end-->

      <!--ä¸ªäººä¿¡æ¯start-->
      <div id="user" v-bind:style="{ left: userLeft + '%' }">
        <div class="userInfoHeader">
          <i class="iconfont icon-left" @click="userLeft==0?userLeft=100:userLeft=0"></i>
          <span>ä¸ªäººä¿¡æ¯</span>
        </div>
        <div class="userContent">
          <div class="userInfoButtonBox">
            <ul>
              <li>
                <div class="floarLeft">
                  <span>å¤´åƒ</span>
                </div>
                <div class="floarRight">
                  <img :src="friendsList[user_id].img" alt="">
                  <input type="file" name="img" class="touxiang" @change="uploadImg(event)">
                </div>
              </li>
              <li>
                <div class="floarLeft">
                  <span>ç”¨æˆ·å</span>
                </div>
                <div class="floarRight">
                  <p v-text="friendsList[user_id].user_name">test</p>
                </div>
              </li>
              <li>
                <div class="floarLeft">
                  <span>ä¸ªäººè¯´æ˜</span>
                </div>
                <div class="floarRight">
                  <p><input type="text" :value="friendsList[user_id].explain" v-model="friendsList[user_id].explain" @blur="editUserInfo()"></p>
                </div>
              </li>
            </ul>
          </div>
        </div>

      </div>
      <!--ä¸ªäººä¿¡æ¯end-->


  </div>
  </body>
<script src="https://cdn.jsdelivr.net/npm/vue"></script>
<script src="INDEX_PUBLIC_JS/jquery.min.js"></script>
<script src="INDEX_PUBLIC_JS/third/layer/layer.js"></script>
<script src="INDEX_PUBLIC_JS/socket.js"></script>
<script src="INDEX_PUBLIC_JS/storage.js"></script>
<!--<script src="INDEX_PUBLIC_JS/data.js"></script>-->
  <script>
    var emoji = 'ğŸ˜€ ğŸ˜ ğŸ˜‚ ğŸ˜ƒ ğŸ˜„ ğŸ˜… ğŸ˜† ğŸ˜‰ ğŸ˜Š ğŸ˜‹ ğŸ˜ ğŸ˜ ğŸ˜˜ ğŸ˜— ğŸ˜™ ğŸ˜š ğŸ˜‡ ğŸ˜ ğŸ˜‘ ğŸ˜¶ ğŸ˜ ğŸ˜£ ğŸ˜¥ ğŸ˜® ğŸ˜¯ ğŸ˜ª ğŸ˜« ğŸ˜´ ğŸ˜Œ ğŸ˜› ğŸ˜œ ğŸ˜ ğŸ˜’ ğŸ˜“ ğŸ˜” ğŸ˜• ğŸ˜² ğŸ˜· ğŸ˜– ğŸ˜ ğŸ˜Ÿ ğŸ˜¤ ğŸ˜¢ ğŸ˜­ ğŸ˜¦ ğŸ˜§ ğŸ˜¨ ğŸ˜¬ ğŸ˜° ğŸ˜± ğŸ˜³ ğŸ˜µ ğŸ˜¡ ğŸ˜ ';
    emoji_arr = emoji.split(' ');
    var emoji_data = {}
    var start = end = 0;
    var row = 10;
    for(var i=1;i<=5;i++){
        start = (i-1)*row
        end = row*i
        emoji_data[i] = emoji_arr.slice(start,end);
    }
    var dataInfo = {
        msg: 'Welcome to Your Vue.js App',
        title: 'æˆ‘çš„IM',
        contentIndex: 0,
        user_id: {$user_id},
        user_name: '{$user_name}',
        left: 100, //èŠå¤©left
        findUserLeft: 100,  //æŸ¥æ‰¾å¥½å‹left
        userInfoLeft: 100,  //å¥½å‹ä¿¡æ¯left
        userLeft: 100,  //ä¸ªäººä¿¡æ¯left
        findUserInfo: {},  //æŸ¥æ‰¾å¥½å‹çš„ä¿¡æ¯
        findApplyList: {
            wCount:2,
            list:[
                /*{
                    id:'1',
                    user_name:'å¼ ä¸‰',
                    img:'http://tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg',
                    memo:'å—¨ï¼Œæ¬¢è¿ä½“éªŒLayIMã€‚æ¼”ç¤ºæ ‡è®°ï¼š1530843285035',
                    status:0
                }*/
            ]
        },  //æŸ¥æ‰¾å¥½å‹çš„ä¿¡æ¯
        msgTitle: {}, //å½“å‰èŠå¤©çš„ç”¨æˆ·
        Message:'',
        findUserText:'',
        userMsg:[], //å½“å‰èŠå¤©ç•Œé¢çš„è®°å½•
        userAllMsg:{
            /*'1-2':[
                {
                    user_id:1,
                    user_name:'å¼ ä¸‰',
                    img:'http://tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg',
                    msg:'å—¨ï¼Œæ¬¢è¿ä½“éªŒLayIMã€‚æ¼”ç¤ºæ ‡è®°ï¼š1530843285035'
                }
            ]*/
        }, //ç”¨æˆ·æ‰€æœ‰çš„èŠå¤©è®°å½•
        footerInfo:[
            {
                text:'æ¶ˆæ¯',
                iconName:'iconfont icon-cc-message'
            },
            {
                text:'è”ç³»äºº',
                iconName:'iconfont icon-user'
            },
            {
                text:'æ›´å¤š',
                iconName:'iconfont icon-more'
            }
        ],
        friendsHeader:[
            {
                text:'æ–°çš„æœ‹å‹',
                iconName:'iconfont icon-plus'
            },
            {
                text:'ç¾¤èŠ',
                iconName:'iconfont icon-users'
            }
        ],
        friendsList:{}, //å¥½å‹åˆ—è¡¨
        groupingList:[], //åˆ†ç»„ä¿¡æ¯
        groupingFriendList:[
            /*{
                id:1,
                name:'çŸ¥åäººç‰©',
                show:false,
                num:'5',
                users:[
                    {
                        user_id:1,
                        img:'http://tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg',
                        user_name:'å¼ ä¸‰',
                        autograph:'è¿™äº›éƒ½æ˜¯æµ‹è¯•æ•°æ®ï¼Œå®é™…ä½¿ç”¨è¯·ä¸¥æ ¼æŒ‰ç…§è¯¥æ ¼å¼è¿”å›'
                    },
                    {
                        user_id:2,
                        img:'http://tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg',
                        user_name:'å¼ ä¸‰',
                        autograph:'è¿™äº›éƒ½æ˜¯æµ‹è¯•æ•°æ®ï¼Œå®é™…ä½¿ç”¨è¯·ä¸¥æ ¼æŒ‰ç…§è¯¥æ ¼å¼è¿”å›'
                    },
                ]
            },
            {
                id:2,
                name:'çŸ¥åäººç‰©2',
                show:false,
                num:'5',
                users:[
                    {
                        user_id:3,
                        img:'http://tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg',
                        user_name:'å¼ ä¸‰',
                        autograph:'è¿™äº›éƒ½æ˜¯æµ‹è¯•æ•°æ®ï¼Œå®é™…ä½¿ç”¨è¯·ä¸¥æ ¼æŒ‰ç…§è¯¥æ ¼å¼è¿”å›'
                    },
                    {
                        user_id:4,
                        img:'http://tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg',
                        user_name:'å¼ ä¸‰',
                        autograph:'è¿™äº›éƒ½æ˜¯æµ‹è¯•æ•°æ®ï¼Œå®é™…ä½¿ç”¨è¯·ä¸¥æ ¼æŒ‰ç…§è¯¥æ ¼å¼è¿”å›'
                    },
                ]
            },
            {
                id:3,
                name:'çŸ¥åäººç‰©3',
                show:false,
                num:'5',
                users:[
                    {
                        user_id:5,
                        img:'http://tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg',
                        user_name:'å¼ ä¸‰',
                        autograph:'è¿™äº›éƒ½æ˜¯æµ‹è¯•æ•°æ®ï¼Œå®é™…ä½¿ç”¨è¯·ä¸¥æ ¼æŒ‰ç…§è¯¥æ ¼å¼è¿”å›'
                    },
                    {
                        user_id:6,
                        img:'http://tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg',
                        user_name:'å¼ ä¸‰',
                        autograph:'è¿™äº›éƒ½æ˜¯æµ‹è¯•æ•°æ®ï¼Œå®é™…ä½¿ç”¨è¯·ä¸¥æ ¼æŒ‰ç…§è¯¥æ ¼å¼è¿”å›'
                    },
                ]
            },*/
        ], //åˆ†ç»„å¥½å‹ä¿¡æ¯
        more:[
            {
                icon:'iconfont icon-shezhi',
                name:'è®¾ç½®'
            },
            {
                icon:'iconfont icon-find',
                name:'åˆ†äº«'
            },
            {
                icon:'iconfont icon-iconset0103',
                name:'å…³äº'
            },
        ],
        websock:null,
        emoji:emoji_data,
        isShowEmoji:0
    }


var addActivity = new Vue({
  el: '.hello',
  data : dataInfo,
  methods:{
    addEmoji:function (key,index) {
      this.Message = this.Message+this.emoji[key][index]
        this.isShowEmoji = 0
    },
    editUserInfo:function () {
      var formData = {};
      formData.explain = this.friendsList[this.user_id].explain;
      console.log(formData)
      var msg = layer.load(2, {time: 10*1000}); //åˆæ¢äº†ç§é£æ ¼ï¼Œå¹¶ä¸”è®¾å®šæœ€é•¿ç­‰å¾…10ç§’
      $.ajax({
          url: "/index/user/editUserInfo",
          type: "post",
          data: formData,
          success: function(data) {
              layer.close(msg)
              if(data.status == 0){
//                  _this.friendsList[_this.user_id].img = data.data
              }else{
                  layer.msg('ä¿®æ”¹å¤±è´¥');
              }
          }
      });
    }, //ä¿®æ”¹ä¸ªäººä¿¡æ¯
    uploadImg:function (e) {
        var _this = this
        var fils = e.target.files["0"];
        if (fils.length == 0) return false
        var i_image = new Image();
        i_image.src = window.URL.createObjectURL(fils)
        i_image.onload = function () {
            var fordate = new FormData();
            fordate.append('img', fils);
            var msg = layer.load(2, {time: 10*1000}); //åˆæ¢äº†ç§é£æ ¼ï¼Œå¹¶ä¸”è®¾å®šæœ€é•¿ç­‰å¾…10ç§’
            $.ajax({
                url: "/index/user/uploadImg",
                type: "post",
                data: fordate,
                processData: false,
                contentType: false,
                success: function(data) {
                    layer.close(msg)
                    if(data.status == 0){
                        _this.friendsList[_this.user_id].img = data.data
                    }else{
                        layer.msg('ä¸Šä¼ å¤±è´¥');
                    }
                }
            });
        }
    }, //ä¸Šä¼ å¤´åƒ
    dealGroupingFriend:function () {
        var data =[]
      for(var i in this.groupingList){
          data[i] = this.groupingList[i]
          data[i].show = false
          data[i].users = []
          for(var j in this.friendsList){
              if(this.groupingList[i].id == this.friendsList[j].grouping && this.friendsList[j].id != this.user_id){
                  data[i].users.push(this.friendsList[j])
              }
          }
          data[i].num = data[i].users.length -1
      }
        this.groupingFriendList = data
    }, //å¤„ç†åˆ†ç»„å¥½å‹
    userFriend:function () {
        var _this = this
        $.ajax({
            type:"POST",
            url:"/index/friend/getFriend",
            data:{},
            error: function() {
//                window.location.reload();
            },
            success: function(result){
                if(result.status == 0){
                    for(var i=0;i<result.data.grouping.length;i++){
                        result.data.grouping[i].show = false
                    }
                    _this.friendsList = result.data.friend
                    _this.groupingList = result.data.grouping
                    _this.dealGroupingFriend()
                }
            }
        });
    },//è·å–åˆ†ç»„å’Œå¥½å‹
    checkUserInfo:function (user,type) {
        console.log(user)
        this.findUserInfo=user
        this.findUserInfo.type = type
        this.userInfoLeft = 0
    },//æŸ¥çœ‹ç”¨æˆ·
    applyDeal:function (item,type) {
        var msg = layer.load(2, {time: 10*1000}); //åˆæ¢äº†ç§é£æ ¼ï¼Œå¹¶ä¸”è®¾å®šæœ€é•¿ç­‰å¾…10ç§’
        $.ajax({
            type:"POST",
            url:"/index/apply/applyDeal",
            data:{id:item.id,type:type},
            error: function() {
//                window.location.reload();
            },
            success: function(result){
                layer.close(msg);
                if(result.status == 0){
                    item.status = type
                    layer.msg('æ·»åŠ æˆåŠŸ')
                }else if(result.status == 1000){
                    item.status = 1
                    layer.msg('å·²ç»æ˜¯å¥½å‹å•¦')
                }else{
                    layer.msg('æ·»åŠ å¤±è´¥')
                }
            }
        });
    },//å¥½å‹ç”³è¯·å¤„ç†
    appayList:function () {
      var _this = this
      if(this.findUserLeft == 100){
          this.findUserLeft = 0
          var msg = layer.load(2, {time: 10*1000}); //åˆæ¢äº†ç§é£æ ¼ï¼Œå¹¶ä¸”è®¾å®šæœ€é•¿ç­‰å¾…10ç§’
          $.ajax({
              type:"POST",
              url:"/index/apply/applyList",
              data:{},
              error: function() {
//                window.location.reload();
              },
              success: function(result){
                  layer.close(msg);
                  if(result.status == 0){
                      _this.findApplyList.wCount = result.data.w_count;
                      _this.findApplyList.list = result.data.list;
                  }else{
                      layer.msg('æ·»åŠ å¤±è´¥')
                  }
              }
          });
      }else{
          this.findUserLeft = 100
      }
    },//å¥½å‹ç”³è¯·åˆ—è¡¨
    addApply:function () {
        var _this = this
        var msg = layer.load(2, {time: 10*1000}); //åˆæ¢äº†ç§é£æ ¼ï¼Œå¹¶ä¸”è®¾å®šæœ€é•¿ç­‰å¾…10ç§’
        $.ajax({
            type:"POST",
            url:"/index/apply/addApply",
            data:{'f_user_id':_this.findUserInfo.id},
            error: function() {
//                window.location.reload();
            },
            success: function(result){
                layer.close(msg);
                if(result.status == 0){
                    layer.msg('ç”³è¯·æˆåŠŸ')
                    _this.userInfoLeft = 100
                }else{
                    layer.msg('ç”³è¯·å¤±è´¥')
                }
            }
        });
    },//ç”³è¯·æ·»åŠ å¥½å‹
    findUser:function () {
        var _this = this
        var msg = layer.load(2, {time: 10*1000}); //åˆæ¢äº†ç§é£æ ¼ï¼Œå¹¶ä¸”è®¾å®šæœ€é•¿ç­‰å¾…10ç§’
        $.ajax({
            type:"POST",
            url:"/index/user/getUserInfo",
            data:{'username':this.findUserText},
            error: function() {
//                window.location.reload();
            },
            success: function(result){
                _this.findUserText = ''
                layer.close(msg);
                if(result.status == 0){
                    _this.checkUserInfo(result.data,1)
                }else{
                    layer.msg('æ²¡æœ‰è¯¥ç”¨æˆ·')
                }
            }
        });
    },//å¥½å‹ä¿¡æ¯
    handleRouter:function(f_user_id){
        var _this = this
        this.left = 0
        this.msgTitle.user_id = f_user_id
        this.msgTitle.user_name = this.friendsList[f_user_id].user_name
        if(this.userAllMsg[f_user_id] != undefined){
            this.userMsg = this.userAllMsg[f_user_id]
        }else{
            this.userMsg = []
        }
        setTimeout(function () {
            _this.findUserLeft=_this.userInfoLeft=100;_this.contentIndex=0;
        },300)
    }, //èŠå¤©ç•Œé¢
    threadPoxi:function(){  // å®é™…è°ƒç”¨çš„æ–¹æ³•

        const agentData = "mymessage";//å‚æ•°
        //è‹¥æ˜¯wså¼€å¯çŠ¶æ€
        if (this.socket.ws.readyState !== this.socket.ws.OPEN) {
            // this.websocketsend(agentData)
            console.log("å·²å¼€å¯")
        }
        // è‹¥æ˜¯ æ­£åœ¨å¼€å¯çŠ¶æ€ï¼Œåˆ™ç­‰å¾…300æ¯«ç§’
        else if (this.socket.ws.readyState === this.socket.ws.CONNECTING) {
            let that = this.socket.ws;//ä¿å­˜å½“å‰å¯¹è±¡this
            setTimeout(function () {
                // that.websocketsend(agentData)
                console.log("å‘é€")
            }, 300);
        }
        // è‹¥æœªå¼€å¯ ï¼Œåˆ™ç­‰å¾…500æ¯«ç§’
        else {
            this.socket.connectSocket;
            let that = this.socket.ws;//ä¿å­˜å½“å‰å¯¹è±¡this
            setTimeout(function () {
                // that.websocketsend(agentData)
                console.log("å‘é€2")
            }, 500);
        }
    },
    senMessage:function () {
        var data = '{"type":"msg","info":"'+this.Message+'","fuid":'+this.msgTitle.user_id+',"uid":'+this.user_id+'}';
        this.socket.ws.send(data);
        var msg = {
            user_id:this.user_id,
            f_user_id:this.msgTitle.user_id,
            user_name:this.user_name,
            img:'http://tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg',
            msg:this.Message
        }
        if(this.userAllMsg[this.msgTitle.user_id] == undefined){
            this.userAllMsg[this.msgTitle.user_id] = []
            this.userMsg = this.userAllMsg[this.msgTitle.user_id]
        }
        this.userAllMsg[this.msgTitle.user_id].push(msg)
        this.Message = ''
    },//å‘é€æ¶ˆæ¯
  },
  mounted:function() {

  },
  created:function () {
//      this.dealGroupingFriend()  //å¤„ç†å¥½å‹åˆ†ç»„æ•°æ®
      console.log(this)
      this.socket = socket
      this.storage = storage
      this.socket.connectSocket(this)
        this.userFriend() //è·å–å¥½å‹
  },
  beforeCreate:function () {
  },
  watch: {  //ç›‘å¬
      userMsg() {
          this.$nextTick(() => {
              var container = this.$el.querySelector("#message .msg_info");
              container.scrollTop = container.scrollHeight;
          })
      }
  }

})
</script>

</html>
